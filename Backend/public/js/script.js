const products =[
    {
       id:1,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_1.png",
        category:'men',
        new_price: 85.0,
    },
    {
        id:2,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_2.png",
        category:'men',
        new_price: 85.0,
    },
    {
        id:3,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_3.png",
        category:'men',
        new_price: 85.0,
    },
    {
        id:4,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_4.png",
        category:'men',
        new_price: 85.0,
    },
    {
        id:5,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_5.png",
        category:'men',
        new_price: 85.0,
    },
    {
        id:6,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_6.png",
        category:'men',
        new_price: 85.0,
    },
    {
        id:7,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_7.png",
        category:'men',
        new_price: 85.0,
    },
    {
        id:8,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_8.png",
        category:'men',
        new_price: 85.0,
    },
    {
        id:9,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_9.png",
        category:'men',
    },
    {
        id:10,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_10.png",
        category:'men',
        new_price: 85,
    },
    {
        id:11,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_11.png",
        category:'men',
        new_price: 85.0,
    },
    {
        id:12,
        name: "Men Green Solid Zippered Full-Zip Slim Fit Bomber Jacket",
        image:"images/product_12.png",
        category:'men',
        new_price: 85.0,
    },
    {
        id:13,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_13.png",
        category:'women',
        new_price:50.00,
    },
    {
        id:14,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_14.png",
        category:'women',
        new_price: 85.0,
    },
    {
        id:15,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_15.png",
        category:'women',
        new_price: 60.0,
        old_price: 100.5,
    },
    {
        id:16,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_16.png",
        category:'women',
        new_price: 100.0,
        old_price: 150.0,
    },
    {
        id:17,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_17.png",
        category:'women',
        new_price: 85.0,
        old_price: 120.5,
    },
    {
        id:18,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_18.png",
        category:'women',
        new_price: 85.0,
        old_price: 120.5,
    },
    {
        id:19,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_19.png",
        category:'women',
        new_price:50.00,
        old_price:80.00,
    },
    {
        id:20,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_20.png",
        category:'women',
        new_price: 85.0,
        old_price: 120.5,
    },
    {
        id:21,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_21.png",
        category:'women',
        new_price: 85.0,
        old_price: 120.5,
    },
    {
        id:22,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_22.png",
        category:'women',
        new_price: 85.0,
        old_price: 120.5,
    },
    {
        id:23,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_23.png",
        category:'women',
        new_price: 85.0,
        old_price: 120.5,
    },
    {
        id:24,
        name:"Striped Fluter Sleeve Overlap Collar Peplun Hem Blouse",
        image:"images/product_24.png",
        category:'women',
        new_price: 85.0,
        old_price: 120.5,
    },
    {
        id:25,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_25.png",
        category:'kid',
        new_price: 85.0,
        old_price: 120.5,
    },
    {
        id:26,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_26.png",
        category:'kid',
        new_price: 85.0,
        
    },
    {
        id:27,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_27.png",
        category:'kid',
        new_price: 85.0,
        
    },
    {
        id:28,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_28.png",
        category:'kid',
        new_price: 85.0,
    },
    {
        id:29,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_29.png",
        category:'kid',
        new_price: 85.0,
    },
    {
        id:30,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_30.png",
        category:'kid',
        new_price: 85.0,
    },
    {
        id:31,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_31.png",
        category:'kid',
        new_price: 85.0,
    },
    {
        id:32,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_32.png",
        category:'kid',
        new_price: 85.0,
    },
    {
        id:33,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_33.png",
        category:'kid',
        new_price: 85.0,
    },
    {
        id:34,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_34.png",
        category:'kid',
        new_price: 85.0,
    },
    {
        id:35,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_35.png",
        category:'kid',
        new_price: 85.0,
    },
    {
        id:36,
        name: "Boys Orange Colourblocked Hooded Sweatshirt",
        image:"images/product_36.png",
        category:'kid',
        new_price: 85.0,
    },
]

//Get the products lists and element
const productList = document.getElementById('productList')
const cartItemsElement = document.getElementById('cartItems')
const cartTotalElement = document.getElementById('cartTotal')
const categoryProductList = document.getElementById('men-product-list')
//get cart items in localStorage
let cart = JSON.parse(localStorage.getItem("cart")) || [];
//Rendering the product list on home page
function renderProduct(){
    productList.innerHTML = products.map(
        (product)=>`
            <div class="product">
        <img src="${product.image}" alt="${product.name}" class="product-img"/>
        <div class="product-info">
            <h2 class="product-title">${product.name}</h2>
             <span class="product-newprice">$${product.new_price}</span>
            <button class="add-to-cart" data-id="${product.id}">Add To cart</button>
        </div>
     </div>
     `
    )
  .join("");
  categoryProductList
  //add to cart
  const addToCartButtons = document.getElementsByClassName('add-to-cart')
  for(let i = 0; i < addToCartButtons.length; i++){
    const addToCartButton = addToCartButtons[i];
    addToCartButton.addEventListener('click',addToCart)
  }
}  
//add to cart
function addToCart(event){
 const productID = parseInt(event.target.dataset.id);
 const product = products.find((product)=>product.id === productID)
 if (product) {
    const existingItem = cart.find((item)=>item.id === productID);
    if (existingItem) {
        existingItem.quantity++;
    }else{
        const cartItem={
            id:product.id,
            name:product.name,
            price:product.new_price,
            image:product.image,
            quantity:1,
        };
        cart.push(cartItem);
    }
    //Change Add to cart text to added
    event.target.textContent="Added"
    updateCartIcon()
    saveToLocalStorage();
    renderCartItems();
    calculateCartTotal();
    updateCartIcon()
    
 }
}
//SaveToLocalstorage
function saveToLocalStorage(){
    localStorage.setItem('cart',JSON.stringify(cart))
}
//Changing quantity from input box and get updated in localstorage
function ChangingQuantity(event){
const productID = parseInt(event.target.dataset.id); 
const quantity = parseInt(event.target.value);
if (quantity > 0 ) {
    const cartItem = cart.find((item)=> item.id ===productID)
    if (cartItem) {
        cartItem.quantity = quantity;
        saveToLocalStorage();
        calculateCartTotal();
        updateCartIcon()
    }
}
}
//remove from cart
function removeFromCart(event){
    const productID = parseInt(event.target.dataset.id);
    cart =cart.filter((item)=>item.id !==productID);
    saveToLocalStorage();
    renderCartItems();
    calculateCartTotal();
}
//rendering product on cart page
function renderCartItems(){
    cartItemsElement.innerHTML= cart.map(
        (item)=>`
        <div class="cart-item">
                    <img src="${item.image}" alt="${item.name}">
                    <div class="cart-items-info">
                        <h2 class="cart-items-title">${item.name}</h2>
                        <input 
                        class="cart-item-input" 
                        type="number" 
                        name="" 
                        min="1"
                        value="${item.quantity}"
                        data-id="${item.id}">
                    </div>
                    <h2 class="cart-item-price">${item.price}</h2>
                    <button class="remove-from-cart" data-id="${item.id}">X</button>
                </div>
     `
    )
    .join("")
    //remove from cart
    const removeButtons = document.getElementsByClassName('remove-from-cart')
  for(let i = 0; i < removeButtons.length; i++){
    const removetButton = removeButtons[i];
    removetButton.addEventListener('click',removeFromCart)
  }
  //Quantity change 
  const quantityInputs = document.querySelectorAll('.cart-item-input')
  quantityInputs.forEach((input)=>{
    input.addEventListener("change",ChangingQuantity)
  })
} 
//calculate total
function calculateCartTotal(){
    const total= cart.reduce((sum,item)=>sum + item.price * item.quantity,0);
    cartTotalElement.textContent =`Total: $${total.toFixed(2)}`;
} 
//check if on cart page
if (window.location.pathname.includes('cart.html')) {
    renderCartItems();
    calculateCartTotal();
}else{
    renderProduct();
}
//calculating Cart Quantity added

const cartIcon = document.getElementById('cart-icon')

function updateCartIcon(){
    const totalQuantity = cart.reduce((sum,item)=> sum + item.quantity,0)
    cartIcon.setAttribute('data-quantity',totalQuantity)
}
updateCartIcon()
function updateCartIconOnCartChanging(){
    updateCartIcon()

}
window.addEventListener('storage',updateCartIconOnCartChanging);
function updateCartIcon(){
    const totalQuantity = cart.reduce((sum,item)=> sum + item.quantity, 0)
    const cartIcon = document.getElementById('cart-icon');
    cartIcon.setAttribute('data-quantity',totalQuantity);
}


renderProduct()
renderCartItems()
calculateCartTotal()